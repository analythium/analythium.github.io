(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{171:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(9),o=(n(0),n(177)),i={id:"shinyproxy-setup",title:"Set Up ShinyProxy"},c={id:"shinyproxy-setup",title:"Set Up ShinyProxy",description:"The ShinyProxy chapter here describes how to set up and customize your very own ShinyProxy server on Ubuntu (18.04 or 20.04).",source:"@site/docs/shinyproxy-setup.md",permalink:"/docs/shinyproxy-setup",editUrl:"https://github.com/analythium/analythium.github.io/edit/source/docs/shinyproxy-setup.md",lastUpdatedBy:"Peter Solymos",lastUpdatedAt:1626793154,sidebar:"docs",previous:{title:"ShinyProxy",permalink:"/docs/shinyproxy"},next:{title:"Secure ShinyProxy",permalink:"/docs/shinyproxy-secure"}},s=[{value:"Create a VM",id:"create-a-vm",children:[]},{value:"Install",id:"install",children:[{value:"Java",id:"java",children:[]},{value:"Docker",id:"docker",children:[]},{value:"ShinyProxy",id:"shinyproxy",children:[]},{value:"Images",id:"images",children:[]},{value:"Configuration",id:"configuration",children:[]},{value:"Nginx",id:"nginx",children:[]},{value:"Firewall",id:"firewall",children:[]}]}],l={rightToc:s};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://hosting.analythium.io/"}),Object(o.b)("img",Object(a.a)({parentName:"a"},{src:"https://hub.analythium.io/assets/marks/hosting-banner-2.jpg",alt:"Hosting Data Apps"})))),Object(o.b)("p",null,"The ShinyProxy chapter here describes how to set up and customize your very own ShinyProxy server on Ubuntu (18.04 or 20.04)."),Object(o.b)("p",null,"If you are short on time, the ",Object(o.b)("strong",{parentName:"p"},"1-Click option")," lets you deploy ShinyProxy on DigitalOcean droplets in fully-tested app environments.\nYou can use ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://m.do.co/c/a8041699739d"}),"this referral link")," to sign up to DigitalOcean if you don't yet have an account."),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://marketplace.digitalocean.com/apps/shinyproxy?refcode=a8041699739d"}),Object(o.b)("img",Object(a.a)({parentName:"a"},{src:"https://raw.githubusercontent.com/analythium/shinyproxy-1-click/master/digitalocean/images/do-btn-blue.svg",alt:"DO button"})))),Object(o.b)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/aoIlaOYRpQs",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),Object(o.b)("h2",{id:"create-a-vm"},"Create a VM"),Object(o.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"You can use your preferred cloud provider or bare metal server\nrunning Ubuntu (18.04 or 20.04) for ShinyProxy. But the rest\nof the tutorial assumes that you use DigitalOcean droplet\nwith Ubuntu 20.04 (LTS)."))),Object(o.b)("p",null,"Use DigitalOcean control panel to create a Droplet based on the\n",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/digitalocean/marketplace-partners#supported-operating-systems"}),"one of the supported OS-es"),"\nfor Marketplace images.\nSelect your preferred region, don't forget to add SSH keys."),Object(o.b)("h2",{id:"install"},"Install"),Object(o.b)("p",null,"Once your droplet is up an running, log in with\n",Object(o.b)("inlineCode",{parentName:"p"},"ssh -i ~/YOUR_SSH_KEY root@YOUR_IP_ADDRESS"),",\nuse your SSH key and IP address."),Object(o.b)("p",null,"Update:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get update\nsudo apt-get upgrade\n")),Object(o.b)("h3",{id:"java"},"Java"),Object(o.b)("p",null,"First, install Java:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get install default-jre\nsudo apt-get install default-jdk\n")),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"java -version")," should return something like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'openjdk version "11.0.8" 2020-07-14\nOpenJDK Runtime Environment (build 11.0.8+10-post-Ubuntu-0ubuntu120.04)\nOpenJDK 64-Bit Server VM (build 11.0.8+10-post-Ubuntu-0ubuntu120.04, mixed mode, sharing)\n')),Object(o.b)("h3",{id:"docker"},"Docker"),Object(o.b)("p",null,"We will install Docker CE (community edition) and Docker Compose:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get install docker\nsudo apt-get install docker-compose\n")),Object(o.b)("p",null,"Check to see if Docker is running ",Object(o.b)("inlineCode",{parentName:"p"},"sudo service docker status"),"."),Object(o.b)("p",null,"ShinyProxy needs to connect to the docker daemon to spin up the containers for the apps.\nBy default ShinyProxy will do so on port 2375 of the docker host.\nIn order to allow for connections on port 2375, the startup options need to be edited\nfollowing the ShinyProxy ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.shinyproxy.io/getting-started/#docker-startup-options"}),"guide"),"."),Object(o.b)("p",null,"On an Ubuntu 16.04 LTS or higher that uses ",Object(o.b)("inlineCode",{parentName:"p"},"systemd"),",\none can create a file ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/systemd/system/docker.service.d/override.conf"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"mkdir /etc/systemd/system/docker.service.d\ntouch /etc/systemd/system/docker.service.d/override.conf\n")),Object(o.b)("p",null,"Add the following content (",Object(o.b)("inlineCode",{parentName:"p"},"vim /etc/systemd/system/docker.service.d/override.conf"),"):"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"[Service]\nExecStart=\nExecStart=/usr/bin/dockerd -H unix:// -D -H tcp://127.0.0.1:2375\n")),Object(o.b)("p",null,"Reload the system daemon and restart Docker:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo systemctl daemon-reload\nsudo systemctl restart docker\nsudo systemctl enable docker\n")),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"sudo systemctl enable docker")," enables Docker service start when the system boots."),Object(o.b)("h3",{id:"shinyproxy"},"ShinyProxy"),Object(o.b)("p",null,"We download the 2.4.0 version of Shinyproxy (in case of newer version, just change the file name accordingly, check for updates ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.shinyproxy.io/downloads/"}),"here"),"):"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo wget https://www.shinyproxy.io/downloads/shinyproxy_2.4.0_amd64.deb\nsudo apt install ./shinyproxy_2.4.0_amd64.deb\nsudo rm shinyproxy_2.4.0_amd64.deb\n")),Object(o.b)("h3",{id:"images"},"Images"),Object(o.b)("p",null,"Pull two demo Docker images ","\u2013"," one of these images is the one we just built in the previous chapter:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo docker pull analythium/shinyproxy-demo:latest\nsudo docker pull registry.gitlab.com/analythium/shinyproxy-hello/hello:latest\n")),Object(o.b)("h3",{id:"configuration"},"Configuration"),Object(o.b)("p",null,"Create ",Object(o.b)("inlineCode",{parentName:"p"},"application.yml")," in the ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/shinyproxy")," directory:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"cd /etc/shinyproxy\nsudo touch application.yml\n")),Object(o.b)("p",null,"You can put here the ",Object(o.b)("inlineCode",{parentName:"p"},"favicon.ico")," file as desired."),Object(o.b)("p",null,"Now copy these configs using ",Object(o.b)("inlineCode",{parentName:"p"},"vim /etc/shinyproxy/application.yml"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-vim"}),'proxy:\n  title: ShinyProxy\n#  logo-url: https://link/to/your/logo.png\n  landing-page: /\n  favicon-path: favicon.ico\n  heartbeat-rate: 10000\n  heartbeat-timeout: 600000\n  port: 8080\n  authentication: simple\n  admin-groups: admins\n  # Example: \'simple\' authentication configuration\n  users:\n  - name: admin\n    password: password\n    groups: admins\n  - name: user\n    password: password\n    groups: users\n  # Docker configuration\n  docker:\n    cert-path: /home/none\n    url: http://localhost:2375\n    port-range-start: 20000\n  specs:\n  - id: 01_hello\n    display-name: Hello Shiny App\n    description: A simple reactive histogram\n    container-cmd: ["R", "-e", "shiny::runApp(\'/root/app\')"]\n    container-image: registry.gitlab.com/analythium/shinyproxy-hello/hello:latest\n    logo-url: https://github.com/analythium/shinyproxy-1-click/raw/master/digitalocean/images/app-hist.png\n    access-groups: [admins, users]\n  - id: 02_hello\n    display-name: Demo Shiny App\n    description: App with sliders and large file upload\n    container-cmd: ["R", "-e", "shiny::runApp(\'/root/app\')"]\n    container-image: analythium/shinyproxy-demo:latest\n    logo-url: https://github.com/analythium/shinyproxy-1-click/raw/master/digitalocean/images/app-dots.png\n    access-groups: [admins]\n\nlogging:\n  file:\n    shinyproxy.log\n\nspring:\n  servlet:\n    multipart:\n      max-file-size: 200MB\n      max-request-size: 200MB\n')),Object(o.b)("p",null,"Edit ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/shinyproxy/application.yml")," as required (file size limits, apps, ",Object(o.b)("inlineCode",{parentName:"p"},"heartbeat-timeout"),"),\nthen restart ShinyProxy to take effect using ",Object(o.b)("inlineCode",{parentName:"p"},"sudo service shinyproxy restart"),".\nRead the ShinyProxy ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.shinyproxy.io/documentation/configuration/"}),"configuration")," documentation."),Object(o.b)("p",null,"Besides adding apps and permissions, edits were made to increase file size limit\nand the default ",Object(o.b)("inlineCode",{parentName:"p"},"heartbeat-timeout: 60000")," (1 minute in milliseconds) to ",Object(o.b)("inlineCode",{parentName:"p"},"600000")," (10 mins), etc. We found these settings more justified in production based on user feedback."),Object(o.b)("p",null,"Now ",Object(o.b)("inlineCode",{parentName:"p"},"cd ~")," back to the home (",Object(o.b)("inlineCode",{parentName:"p"},"/root"),") folder to continue."),Object(o.b)("h3",{id:"nginx"},"Nginx"),Object(o.b)("p",null,"ShinyProxy is now can be accessed at ",Object(o.b)("inlineCode",{parentName:"p"},"YOUR_IP_ADDRESS:8080"),". We can set the port to 80\nwhich is the standard HTTP port.\nInstall Nginx:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt-get install nginx\n")),Object(o.b)("p",null,"Edit the config file:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo vim /etc/nginx/sites-enabled/default\n")),Object(o.b)("p",null,"Find the ",Object(o.b)("inlineCode",{parentName:"p"},"location / {")," line and add the following:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),'location / {\n    proxy_pass          http://127.0.0.1:8080/;\n\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection "upgrade";\n    proxy_read_timeout 600s;\n\n    proxy_redirect    off;\n    proxy_set_header  Host             $http_host;\n    proxy_set_header  X-Real-IP        $remote_addr;\n    proxy_set_header  X-Forwarded-For  $proxy_add_x_forwarded_for;\n    proxy_set_header  X-Forwarded-Protocol $scheme;\n}\n')),Object(o.b)("p",null,"Add ",Object(o.b)("inlineCode",{parentName:"p"},"client_max_body_size 200M;")," to the ",Object(o.b)("inlineCode",{parentName:"p"},"server {")," block if handling large files is needed."),Object(o.b)("p",null,"Restart nginx with ",Object(o.b)("inlineCode",{parentName:"p"},"sudo service nginx restart")," and you can access the site at ",Object(o.b)("inlineCode",{parentName:"p"},"http://YOUR_IP_ADDRESS/"),"."),Object(o.b)("h3",{id:"firewall"},"Firewall"),Object(o.b)("p",null,"UFW is an Uncomplicated Firewall.\nWe enables the UFW firewall to allow only SSH, HTTP and HTTPS.\nSee a detailed tutorial ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-20-04"}),"here"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"sudo apt install ufw\n\nsudo ufw default deny incoming\nsudo ufw default allow outgoing\n\nsudo ufw allow ssh\nsudo ufw allow http\n")),Object(o.b)("p",null,"Finally, enable these rules by running\n",Object(o.b)("inlineCode",{parentName:"p"},"sudo ufw enable"),". This also disables the previously used 8080 port.\nCheck ",Object(o.b)("inlineCode",{parentName:"p"},"ufw status")," to see:"),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"Status: active\n\nTo                         Action      From\n--                         ------      ----\n22/tcp                     ALLOW       Anywhere\n80/tcp                     ALLOW       Anywhere\n22/tcp (v6)                ALLOW       Anywhere (v6)\n80/tcp (v6)                ALLOW       Anywhere (v6)\n")),Object(o.b)("p",null,Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://hosting.analythium.io/"}),Object(o.b)("img",Object(a.a)({parentName:"a"},{src:"https://hub.analythium.io/assets/marks/hosting-banner-2.jpg",alt:"Hosting Data Apps"})))))}p.isMDXComponent=!0},177:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=p(n),u=a,h=b["".concat(i,".").concat(u)]||b[u]||d[u]||o;return n?r.a.createElement(h,c(c({ref:t},l),{},{components:n})):r.a.createElement(h,c({ref:t},l))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=u;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);