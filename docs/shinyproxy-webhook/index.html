<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Analythium Hub Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Analythium Hub Blog Atom Feed">
<script src="https://www.googletagmanager.com/gtag/js?id=UA-147215898-3" async></script>
<script src="gascript.js"></script>
<script src="https://cdn.usefathom.com/script.js" data-site="XXTESXHY" defer="defer"></script><title data-react-helmet="true">CI/CD with Webhook | Analythium Hub</title><meta data-react-helmet="true" property="og:image" content="https://hub.analythium.io/img/hub-thumb.png"><meta data-react-helmet="true" property="twitter:image" content="https://hub.analythium.io/img/hub-thumb.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Analythium Hub"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="CI/CD with Webhook | Analythium Hub"><meta data-react-helmet="true" name="description" content="This guide explains how to set up webhook for ShinyProxy."><meta data-react-helmet="true" property="og:description" content="This guide explains how to set up webhook for ShinyProxy."><meta data-react-helmet="true" property="og:url" content="https://hub.analythium.io/docs/shinyproxy-webhook"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://hub.analythium.io/docs/shinyproxy-webhook"><link rel="stylesheet" href="/styles.d0f00354.css">
<link rel="preload" href="/styles.b9b32f90.js" as="script">
<link rel="preload" href="/runtime~main.dbf1f8dc.js" as="script">
<link rel="preload" href="/main.3c4e732c.js" as="script">
<link rel="preload" href="/1.bea984e9.js" as="script">
<link rel="preload" href="/2.68b92899.js" as="script">
<link rel="preload" href="/3.a83cd0b4.js" as="script">
<link rel="preload" href="/1be78505.4d532cf0.js" as="script">
<link rel="preload" href="/47.72b6c03e.js" as="script">
<link rel="preload" href="/20ac7829.9b5e15af.js" as="script">
<link rel="preload" href="/0eea26b0.15debcb9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_OaSq"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a href="https://hub.analythium.io/" target="_self" rel="noopener noreferrer" class="navbar__brand" to="https://hub.analythium.io/"><img class="navbar__logo" src="/img/logo.svg" alt="Analythium Logo"><strong class="navbar__title">Analythium Hub</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/analythium/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://hub.analythium.io/" target="_self" rel="noopener noreferrer" class="navbar__brand" to="https://hub.analythium.io/"><img class="navbar__logo" src="/img/logo.svg" alt="Analythium Logo"><strong class="navbar__title">Analythium Hub</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/">News</a></li><li class="menu__list-item"><a href="https://github.com/analythium/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs sidebarWithHideableNavbar_1-U5"><a href="https://hub.analythium.io/" target="_self" rel="noopener noreferrer" tabindex="-1" class="sidebarLogo_3ono" to="https://hub.analythium.io/"><img src="/img/logo.svg" alt="Analythium Logo"><strong>Analythium Hub</strong></a><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Shiny</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shiny">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shiny-ui">Shiny UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shiny-server">Server Function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/shiny-app">Shiny App</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Containers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/containers">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/containers-docker">Docker Basics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/containers-shiny">Shiny in Docker</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">ShinyProxy</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shinyproxy">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shinyproxy-setup">Set Up ShinyProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shinyproxy-secure">Secure ShinyProxy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shinyproxy-update">Update ShinyProxy</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/shinyproxy-webhook">CI/CD with Webhook</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">CI/CD with Webhook</h1></header><div class="markdown"><p><a href="https://hosting.analythium.io/?utm_source=as-hub&amp;utm_medium=web&amp;utm_campaign=evergreen" target="_blank" rel="noopener noreferrer"><img src="https://hub.analythium.io/assets/marks/hosting-banner-2.jpg" alt="Hosting Data Apps"></a></p><p>This guide explains how to set up webhook for ShinyProxy.
We assume ShinyProxy is running on DigitalOcean droplet
with Ubuntu 20.04 (LTS).</p><p><a href="https://marketplace.digitalocean.com/apps/shinyproxy?refcode=a8041699739d" target="_blank" rel="noopener noreferrer"><img src="https://raw.githubusercontent.com/analythium/shinyproxy-1-click/master/digitalocean/images/do-btn-blue.svg" alt="DO button"></a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="port-for-webhook"></a>Port for webhook<a aria-hidden="true" tabindex="-1" class="hash-link" href="#port-for-webhook" title="Direct link to heading">#</a></h2><p>UFW is an Uncomplicated Firewall.
We enables the UFW firewall to allow only SSH, HTTP and HTTPS.
See a detailed tutorial <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-20-04" target="_blank" rel="noopener noreferrer">here</a>.
Settings we did <a href="/docs/shinyproxy-setup">previously</a> are commented out, uncomment
as needed.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#sudo apt install ufw</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#sudo ufw default deny incoming</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#sudo ufw default allow outgoing</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#sudo ufw allow ssh</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#sudo ufw allow http</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#sudo ufw allow https</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> ufw allow </span><span class="token number">9000</span></div></div></div></div></div><p>Finally, enable these rules by running <code>sudo ufw enable</code>.
Check <code>ufw status</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="install-webhook"></a>Install webhook<a aria-hidden="true" tabindex="-1" class="hash-link" href="#install-webhook" title="Direct link to heading">#</a></h2><p>We are going to use <a href="https://github.com/adnanh/webhook" target="_blank" rel="noopener noreferrer">webhook</a>.
The community maintained <code>sudo apt-get install webhook</code> gives a really outdated version.
Therefore we pick the latest (2.7.0) using pre-compiled binary for our
architecture (if in doubt, check <code>dpkg --print-architecture</code>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> https://github.com/adnanh/webhook/releases/download/2.7.0/webhook-linux-amd64.tar.gz</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> -zxvf webhook-linux-amd64.tar.gz</span></div></div></div></div></div><p>Next we will follow <a href="https://davidauthier.com/blog/2017/09/07/deploy-using-github-webhooks/" target="_blank" rel="noopener noreferrer">this</a> guide
and we move the binary and other files with settings in the <code>/var/www/webhooks</code> directory:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> /var/www/webhooks</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> webhook-linux-amd64/webhook /var/www/webhooks/</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> -rf *</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="hook-definitions"></a>Hook definitions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#hook-definitions" title="Direct link to heading">#</a></h2><p>Create the file <code>hooks.json</code> to store the hook definitions:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /var/www/webhooks/hooks.json</span></div></div></div></div></div><p>The following array of hook definitions goes inside (<code>vim /var/www/webhooks/hooks.json</code>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pull-all-gitlab&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;execute-command&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webhook-pull-all-gitlab&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Pulling all Docker images.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-headers&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;trigger-rule&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;value&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;secret_token_1234&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;parameter&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;header&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Gitlab-Token&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pull-one-gitlab&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;execute-command&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webhook-pull-one-gitlab&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Pulling Docker image.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-headers&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;pass-arguments-to-command&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;payload&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;image_name&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;trigger-rule&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token property">&quot;match&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;value&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;secret_token_1234&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;parameter&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;header&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Gitlab-Token&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;pull-one-dockerhub&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;execute-command&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;webhook-pull-one-dockerhub&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-message&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Pulling Docker image from Docker Hub.&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;response-headers&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;*&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;pass-arguments-to-command&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;payload&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;repository.repo_name&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;payload&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;push_data.tag&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="update-all-images"></a>Update all images<a aria-hidden="true" tabindex="-1" class="hash-link" href="#update-all-images" title="Direct link to heading">#</a></h3><p>This array contains 3 hooks. The 1st and the second is
set up to work with GitLab CI/CD pipelines.
See corresponding <code>.gitlab-ci.yml</code> file <a href="https://gitlab.com/analythium/shinyproxy-hello/-/blob/master/.gitlab-ci.yml">here</a> (check parts that are commented out in the YAML file).</p><p>These need a secret header (value <code>&quot;secret_token_1234&quot;</code>)
that is used in the hook definition and in the webhook request. Change to some random
high entropy value.</p><p>The 1st hook definition calls the command <code>webhook-pull-all-gitlab</code> without arguments.
The command pulls the latest version of all the docker images that are on the server.
After that, it cleans up the dangling images. So let&#x27;s put this command into
the <code>/bin</code> folder and make it executable:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /bin/webhook-pull-all-gitlab</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> </span><span class="token number">755</span><span class="token plain"> /bin/webhook-pull-all-gitlab</span></div></div></div></div></div><p>This is the content that goes inside the file:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token shebang important">#! /bin/sh</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker images </span><span class="token operator">|</span><span class="token function" style="color:rgb(80, 250, 123)">grep</span><span class="token plain"> -v REPOSITORY</span><span class="token operator">|</span><span class="token function" style="color:rgb(80, 250, 123)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{print </span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;:&quot;</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token string" style="color:rgb(255, 121, 198)">}&#x27;</span><span class="token operator">|</span><span class="token function" style="color:rgb(80, 250, 123)">xargs</span><span class="token plain"> -L1 docker pull</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker system prune -f</span></div></div></div></div></div><p><code>docker login</code> might be needed when using private registries.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="gitlab-registry"></a>GitLab registry<a aria-hidden="true" tabindex="-1" class="hash-link" href="#gitlab-registry" title="Direct link to heading">#</a></h3><p>The second hook definition uses the command <code>webhook-pull-one-gitlab</code> which
pulls a single image based on the argument passed.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /bin/webhook-pull-one-gitlab</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> </span><span class="token number">755</span><span class="token plain"> /bin/webhook-pull-one-gitlab</span></div></div></div></div></div><p>The content of the file:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token shebang important">#! /bin/sh</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker pull </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">docker system prune -f</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="docker-hub"></a>Docker Hub<a aria-hidden="true" tabindex="-1" class="hash-link" href="#docker-hub" title="Direct link to heading">#</a></h3><p>The 3rd hook definition is similar the previous hook in that it also pulls a single
docker image. But this one is written for the payload that Docker Hub&#x27;s webhook
delivers (read more <a href="https://docs.docker.com/docker-hub/webhooks/#example-webhook-payload" target="_blank" rel="noopener noreferrer">here</a>).</p><p>The image name and the tag are parsed separately, so the <code>webhook-pull-one-dockerhub</code>
takes these two arguments:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /bin/webhook-pull-one-dockerhub</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> </span><span class="token number">755</span><span class="token plain"> /bin/webhook-pull-one-dockerhub</span></div></div></div></div></div><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token shebang important">#! /bin/sh</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/bin/docker pull </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$1</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$2</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/bin/docker system prune -f</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="webhook-service"></a>Webhook service<a aria-hidden="true" tabindex="-1" class="hash-link" href="#webhook-service" title="Direct link to heading">#</a></h2><p>Now create the <code>webhook.service</code> file with the daemon settings via <code>systemctl</code>:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">touch</span><span class="token plain"> /etc/systemd/system/webhook.service</span></div></div></div></div></div><p>Put these into the service file (<code>vim /etc/systemd/system/webhook.service</code>):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-vim codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">[Unit]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">Description=Webhooks</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[Service]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">ExecStart=/var/www/webhooks/webhook -hooks /var/www/webhooks/hooks.json -hotreload</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[Install]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">WantedBy=multi-user.target</span></div></div></div></div></div><p>The option <code>-hotreload</code> watches for changes in the <code>hook.json</code> file and reloads them upon change.</p><p>Run a few commands with <code>systemctl</code>:
<code>sudo systemctl enable webhook.service</code> to enable the newly created service,
<code>sudo systemctl start webhook.service</code> to start the service.</p><p>Now check the service status using <code>sudo service webhook status</code>. If all went well,
you should see something like:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">‚óè webhook.service - Webhooks</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Loaded: loaded </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">/etc/systemd/system/webhook.service</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> enabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> vendor preset: enabled</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   Active: active </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">running</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> since Fri </span><span class="token number">2020</span><span class="token plain">-06-05 07:31:31 UTC</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> 6s ago</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"> Main PID: </span><span class="token number">5228</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">webhook</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    Tasks: </span><span class="token number">6</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">limit: </span><span class="token number">1152</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">   CGroup: /system.slice/webhook.service</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">           ‚îî‚îÄ5228 /var/www/webhooks/webhook -hooks /var/www/webhooks/hooks.json -hotreload</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="enabling-https"></a>Enabling HTTPS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#enabling-https" title="Direct link to heading">#</a></h2><p>Add <code>-secure</code> flag to watch over https. This requires also passing the certificate:
check name of certificate and private key in the dir <code>/etc/letsencrypt/live/example.com/</code>,
the add <code>-secure -cert /etc/letsencrypt/live/test.side-r.com/cert.pem -key /etc/letsencrypt/live/test.side-r.com/privkey.pem</code> to the <code>/etc/systemd/system/webhook.service</code> service file.
Use private key (<code>privkey.pem</code>) and <code>fullchain.pem</code> which is concatenation of the public key
(<code>cert.pem</code>) and the certificate chain (<code>chain.pem</code>).</p><p>Use <code>crontab -e</code> and add the line <code>0 2 * * * systemctl restart webhook.service</code>:
we need to restart the webhook daemon regularly (daily in this case)
because it is not updating when the TLS certificate is renewed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing-with-curl"></a>Testing with curl<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing-with-curl" title="Direct link to heading">#</a></h2><p>Test it in <code>-verbose</code> mode: change <code>example.com</code> to your domain.
Have to open up another port, here 9001, because 9000 is taken by the daemon:
<code>/var/www/webhooks/webhook -hooks /var/www/webhooks/hooks.json -hotreload -verbose -secure -cert /etc/letsencrypt/live/test.side-r.com/fullchain.pem -key /etc/letsencrypt/live/test.side-r.com/privkey.pem -port 9001</code></p><p>See more parameter settings <a href="https://github.com/adnanh/webhook/blob/master/docs/Webhook-Parameters.md">here</a>.</p><p>Note: we are testing over port 9001, but the real webhook is listening on port 9000.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="gitlab"></a>GitLab<a aria-hidden="true" tabindex="-1" class="hash-link" href="#gitlab" title="Direct link to heading">#</a></h3><p>We use <code>curl -i</code> to get the response headers: 200 is what we want. Make sure to use http
protocol (and not https) if SSL certificate is not set up and used.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -i --header </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Gitlab-Token: secret_token_1234&quot;</span><span class="token plain"> https://YOUR_IP_OR_DOMAIN:9000/hooks/pull-all-gitlab</span></div></div></div></div></div><p>Using form data (url encoded, default header &quot;Content-Type: application/x-www-form-urlencoded&quot;):</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -i --header </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Gitlab-Token: secret_token_1234&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  -X POST -d </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;image_name=analythium/shinyproxy-demo:latest&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  https://YOUR_IP_OR_DOMAIN:9000/hooks/pull-one-gitlab</span></div></div></div></div></div><p>Need to declare content-type header, payload is treated as form data by curl:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">curl</span><span class="token plain"> -i --header </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;X-Gitlab-Token: secret_token_1234&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  --header </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Content-Type: application/json&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  --request POST </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  --data </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;{&quot;image_name&quot;:&quot;analythium/shinyproxy-demo:latest&quot;}&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  https://YOUR_IP_OR_DOMAIN:9000/hooks/pull-one-gitlab</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="docker-hub-1"></a>Docker Hub<a aria-hidden="true" tabindex="-1" class="hash-link" href="#docker-hub-1" title="Direct link to heading">#</a></h3><p>This is how the simplified Docker Hub payload looks like, we can use it to get the
image name and the tag:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-json codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;push_data&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;pusher&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;trustedbuilder&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;latest&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token property">&quot;repository&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;testhook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;namespace&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;svendowideit&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;owner&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;svendowideit&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;repo_name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;svendowideit/testhook&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;repo_url&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://registry.hub.docker.com/u/svendowideit/testhook/&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;star_count&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Active&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></div></div></div></div></div><p>Set webhook url as <code>https://YOUR_IP_OR_DOMAIN:9000/hooks/pull-one-dockerhub</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="wrapping-up"></a>Wrapping up<a aria-hidden="true" tabindex="-1" class="hash-link" href="#wrapping-up" title="Direct link to heading">#</a></h2><p>At the end of all this, we have the full CI/CD experience over HTTPS:</p><p><img src="../../img/shinyproxy/workflow.png" alt="CI/CD workflow" title="CI/CD workflow"></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Contact us!</h5></div><div class="admonition-content"><p>Would you like to run your own ShinyProxy server with CICD pipelines? Reach out to <a href="https://analythium.io/#contact" target="_blank" rel="noopener noreferrer">Analythium</a> if you need commercial support and consulting services!</p></div></div><p><a href="https://hosting.analythium.io/?utm_source=as-hub&amp;utm_medium=web&amp;utm_campaign=evergreen" target="_blank" rel="noopener noreferrer"><img src="https://hub.analythium.io/assets/marks/hosting-banner-2.jpg" alt="Hosting Data Apps"></a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/analythium/analythium.github.io/edit/source/docs/shinyproxy-webhook.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2023-02-02T02:15:09.000Z" class="docLastUpdatedAt_1sqk">2/2/2023</time> by <strong>Peter Solymos</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/shinyproxy-update"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Update ShinyProxy</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#port-for-webhook" class="table-of-contents__link">Port for webhook</a></li><li><a href="#install-webhook" class="table-of-contents__link">Install webhook</a></li><li><a href="#hook-definitions" class="table-of-contents__link">Hook definitions</a><ul><li><a href="#update-all-images" class="table-of-contents__link">Update all images</a></li><li><a href="#gitlab-registry" class="table-of-contents__link">GitLab registry</a></li><li><a href="#docker-hub" class="table-of-contents__link">Docker Hub</a></li></ul></li><li><a href="#webhook-service" class="table-of-contents__link">Webhook service</a></li><li><a href="#enabling-https" class="table-of-contents__link">Enabling HTTPS</a></li><li><a href="#testing-with-curl" class="table-of-contents__link">Testing with curl</a><ul><li><a href="#gitlab" class="table-of-contents__link">GitLab</a></li><li><a href="#docker-hub-1" class="table-of-contents__link">Docker Hub</a></li></ul></li><li><a href="#wrapping-up" class="table-of-contents__link">Wrapping up</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/analythium" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/analythium/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.analythium.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Analythium.io</a></li><li class="footer__item"><a href="https://blog.analythium.io" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://blog.analythium.io">Analythium blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.analythium.io/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy policy</a></li><li class="footer__item"><a href="https://www.analythium.io/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.analythium.io/terms/">Terms of service</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://hub.analythium.io" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Analythium Logo" src="https://hub.analythium.io/assets/marks/word-mark-dark-yellow-wide.png"></a></div><div>Copyright ¬© 2023 Analythium Solutions Inc.</div></div></div></footer></div>
<script src="/styles.b9b32f90.js"></script>
<script src="/runtime~main.dbf1f8dc.js"></script>
<script src="/main.3c4e732c.js"></script>
<script src="/1.bea984e9.js"></script>
<script src="/2.68b92899.js"></script>
<script src="/3.a83cd0b4.js"></script>
<script src="/1be78505.4d532cf0.js"></script>
<script src="/47.72b6c03e.js"></script>
<script src="/20ac7829.9b5e15af.js"></script>
<script src="/0eea26b0.15debcb9.js"></script>
</body>
</html>